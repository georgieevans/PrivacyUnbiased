---
title: "PrivacyUnbiased"
output: pdf_document
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE}
library(PrivacyUnbiased)
```

## Installing PrivacyUnbiased 

To install `PrivacyUnbiased`, run:

```{r, eval = FALSE}

pkgs <- c("devtools", "Matrix", "mvtnorm", "gdata", "matrixcalc")

for (pkg in pkgs) {
  if (!require(pkg, character.only = T)) {
    install.packages(pkg)
    library(pkg)
  }
}

devtools::install_github("georgieevans/PrivacyUnbiased")
library(PrivacyUnbiased)

```

## Simple example

```{r sim data, echo = FALSE}
N <- 100000
data <- genData(N)
original_data <- data$original_data
data_error <- data$data_error
```

We use some hypothetical data to demonstrate how the packages main functions can be used.

```{r estimate}

lmdp_test <- lmdp(Y ~ X1 + X2 + X3, data = data_error)

```

`lmdp()` is the core function for estimating bias corrected coefficients. Users can interact with it simiilarly to  `lm()`, by inputting to the function a formula and a data frame. 

An important distinction between `lmdp()` and `lm()` is that the first row of `data` must contain the DP error variances associated with the column. For instance, if we look at `data_error`, we see that no noise was added to $Y$, the noiise variance for $X1$ was 4, etc. 

```{r head}
head(data_error)
```

The output from `lmdp()`can be summarized using `summary()`, just like a standard `lm` object. 


```{r summary}
summary(lmdp_test)
```


It is informative to compare this to the estimates produced from `lm()` to see the impact of our bias correction: 

```{r}

lm_test <- lm(Y ~ X1 + X2 + X3, data = data_error[-1, ])

# Uncorrected OLS estimates
summary(lm_test)$coef

# The truth 
lm_true <- lm(Y ~ Z1 + Z2 + Z3, data = original_data)

# OLS estimates on data before noise added 
summary(lm_true)$coef
```


The additional output from `lmdp()` is stored in a list that can be accessed as follows: 

```{r full output}
# This summarizes the output of an lmdp object
str(lmdp_test)

# For instance we can access the variance covariance matrix as follows
lmdp_test$beta_tilde_vcov
```


## Variance estimation 

- Describe the default settings
- Describe how to choose the variance estimation procedure by altering the default argument
- Describe the possibility that the estimated vc isn't PD and what we do about it


## Variable transformation

- Describe limitations on variable transformation, and transformation allowed
- Note that only bootstrap can be used at the moment with transformed variables
